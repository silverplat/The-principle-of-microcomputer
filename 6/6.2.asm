;8254计数器1工作在方式3
A8254 EQU 0600H
B8254 EQU 0602H 
C8254 EQU 0604H 
CON8254 EQU 0606H

CODE SEGMENT 
    ASSUME CS:CODE
START: 
	MOV DX,0646H
	MOV AL,10000000B
	OUT DX,AL
	MOV DX,0642H
	MOV AL,00H
	OUT DX,AL
	
	MOV BL,00H
	
	MOV AX,OFFSET MIR6	
	MOV SI,0038H		
	MOV [SI],AX
	MOV AX,CS
	MOV SI,003AH 
	MOV [SI],AX
	
	CLI

	MOV AL,11H			;ICW1
	OUT 20H,AL
	MOV AL,08H			;ICW2
	OUT 21H,AL
	MOV AL,04H			;ICW3
	OUT 21H,AL
	MOV AL,03H			;ICW4
	OUT 21H,AL
	MOV AL,10101111B	;OCW1
	OUT 21H,AL

	STI
 
    MOV DX, CON8254
    MOV AL, 76H             
    OUT DX, AL 
    MOV DX, B8254 
    MOV AL, 00H 
    OUT DX, AL 
    MOV AL, 48H             ;计数初值4800H
    OUT DX, AL 
AA1: 
    JMP AA1 
    
MIR6:
	
	MOV DX,0642H
	SHL BL,1
	ADD BL,1
	MOV AL,BL
	OUT DX,AL
	
	CMP AL,0FFH
	JZ E
	IRET
	
E:
	MOV AH,4CH
	INT 21H
;输出周期1S方波。
CODE ENDS 
    END START